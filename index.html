<!DOCTYPE html>
<html>
 <head>
  <title>Ultimate Tic Tac Toe</title>
  <style>
      
*{
    margin:0;
    padding:0;
}
body{
	background-color: black;
}
td{
	background-color: white;
}
table{
	width:100vmin;
	height:100vmin;
	margin:0 auto;
}
table table{
	width :100%;
	height:100%;
	border-spacing: 0;	
}
td[style~="background-color:"] tbody{
	opacity : 0;
}
table table tbody:hover{
	opacity:1;
}
  </style>
  <script>

var c_t, c_b, c_s, turn = true, game_end = false;
window.addEventListener("load", function (e)
{
	c_t = document.getElementsByTagName("TABLE")[0];
	c_b = Array.from(c_t.getElementsByTagName("TABLE"), x=>x.parentElement);
	c_s = Array.from(c_b, x=>x.getElementsByTagName("TD"));
	function getListener(i, j){return function (e){uttt(i, j);};}
	for(let i = 0; i < 9;++i)for(let j = 0;j<9;++j)c_s[i][j].addEventListener("click", getListener(i,j));
});


function test(arr, color)
{
	for(let i of [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]])
		if(
            arr[i[0]].style.backgroundColor == color 
			&& arr[i[1]].style.backgroundColor == color 
			&& arr[i[2]].style.backgroundColor == color) return true;
	return false;
}

function uttt(i, j)
{
	if(c_b[i].style.opacity || c_b[i].style.backgroundColor || c_s[i][j].style.backgroundColor || game_end)return;
	color = turn?"red":"blue";
	turn = !turn;
    c_s[i][j].style.backgroundColor = color;
	if(test(c_s[i], color))
	{
        c_b[i].style.backgroundColor = color;
		if(test(c_b, color))
        {
			alert(color + " win!");
            game_end = true;
            for(let x of c_b)x.style.opacity = "";
            return;
        }
	}
	else
	{
		let k = 0;
		for(;k<9 && c_s[i][k].style.backgroundColor; ++k);
		if(k==9)c_b[i].style.backgroundColor = "transparent";
	}
    for(let k = 0; k < 9; ++k)
		c_b[k].style.opacity = (j==k || c_b[j].style.backgroundColor? "" : 0.5);
}
	</script>
 </head>
 <body>
   <table>
    <tr>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
    </tr>
    <tr>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
    </tr>
    <tr>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
     <td><table><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td>
    </tr>
   </table>
</div>
 </body>
</html>
